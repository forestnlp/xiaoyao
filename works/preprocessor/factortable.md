# FactorTable 核心指标字段说明文档

## 文档说明

本文档针对精简版`factortable.parquet`数据文件，详细说明各字段的定义、计算逻辑及在选股策略中的作用。所有字段均围绕 “前期上涨→健康回调→支撑企稳→启动信号” 的波段选股逻辑设计，无冗余指标，可直接用于策略筛选。

## 一、基础标识字段



| 字段名称         | 数据类型            | 说明                                       |
| ------------ | --------------- | ---------------------------------------- |
| `stock_code` | string          | 股票代码（如 000001.XSHE、600000.XSHG），唯一标识单只股票 |
| `date`       | datetime64\[ns] | 交易日期（格式：YYYY-MM-DD），标识指标对应的交易日           |
| `close`      | float64         | 当日收盘价，所有价格类指标的计算基础                       |

## 二、趋势基础指标（判断整体趋势方向）

### 1. 移动平均线



| 字段名称   | 数据类型    | 计算逻辑                            | 选股作用                                         |
| ------ | ------- | ------------------------------- | -------------------------------------------- |
| `ma5`  | float64 | 当日及前 4 个交易日收盘价的算术平均值（5 日滚动窗口）   | 短期趋势参考，判断股价短期走势是否平稳向上                        |
| `ma20` | float64 | 当日及前 19 个交易日收盘价的算术平均值（20 日滚动窗口） | 短期趋势核心指标，用于判断股价是否站稳短期支撑位（选股中需满足`close≥ma20`） |

### 2. MACD 相关指标



| 字段名称                | 数据类型    | 计算逻辑                                                 | 选股作用                                |
| ------------------- | ------- | ---------------------------------------------------- | ----------------------------------- |
| `macd_line`         | float64 | 快速 EMA（12 日）与慢速 EMA（26 日）的差值                         | MACD 核心线，反映趋势动能方向                   |
| `signal_line`       | float64 | `macd_line`的 9 日 EMA（信号线）                            | 趋势反转信号参考，与`macd_line`交叉形成金叉 / 死叉    |
| `macd_hist`         | float64 | `macd_line`与`signal_line`的差值（柱状图）                    | 动能强弱判断，正数表示多头动能，选股中需满足`macd_hist≥0` |
| `macd_golden_cross` | bool    | 当日`macd_line>signal_line`且前一日`macd_line≤signal_line` | 趋势反转启动信号，选股核心条件之一（确认多头趋势开始）         |

## 三、量能支撑指标（判断资金流向与活跃度）



| 字段名称              | 数据类型    | 计算逻辑                                       | 选股作用                                    |
| ----------------- | ------- | ------------------------------------------ | --------------------------------------- |
| `obv`             | float64 | 能量潮指标：当日收盘价 > 前日则加当日成交量，< 前日则减，= 则不变       | 反映资金持续流向，判断股价涨跌是否有资金支撑                  |
| `volume_ratio_5d` | float64 | 当日成交量 ÷ 前 5 日成交量均值（剔除当日），分母为 0 时替换为 0.0001 | 量能放大 / 缩小判断：上涨阶段需≥1.2（放量），回调阶段需≤0.8（缩量） |

## 四、阶段回调指标（判断前期上涨与回调健康度）



| 字段名称             | 数据类型            | 计算逻辑                                               | 选股作用                                           |
| ---------------- | --------------- | -------------------------------------------------- | ---------------------------------------------- |
| `high_30d`       | float64         | 当日及前 29 个交易日收盘价的最大值（30 日滚动窗口）                      | 定位前期上涨高点，作为回调幅度计算的基准                           |
| `high_date_30d`  | datetime64\[ns] | `high_30d`对应的交易日（即 30 日窗口内收盘价最高的日期）                | 计算回调天数的基准，判断回调时间是否合理                           |
| `pullback_ratio` | float64         | （`high_30d` - 当日收盘价）÷ `high_30d`，分母为 0 时替换为 0.0001 | 回调幅度判断，选股需满足 10%-20%（`0.1≤pullback_ratio≤0.2`） |
| `pullback_days`  | int64           | 当日日期 - `high_date_30d` 的天数差（非自然日，仅计算交易日间隔）         | 回调时间判断，选股需满足 10-20 天（`10≤pullback_days≤20`）    |

## 五、支撑位企稳指标（判断回调后是否触底）

### 1. 布林带相关



| 字段名称                       | 数据类型    | 计算逻辑                                     | 选股作用                 |
| -------------------------- | ------- | ---------------------------------------- | -------------------- |
| `bollinger_lower`          | float64 | 布林带下轨：20 日收盘价均值 - 2×20 日收盘价标准差（滚动窗口）     | 重要支撑位参考，反映股价短期超跌边界   |
| `touch_bollinger_lower_3d` | bool    | 当日、前 1 日、前 2 日中任意一天收盘价≤`bollinger_lower` | 判断股价是否触及支撑位，确认回调企稳信号 |

### 2. RSI 相关



| 字段名称           | 数据类型    | 计算逻辑                              | 选股作用                             |
| -------------- | ------- | --------------------------------- | -------------------------------- |
| `rsi14`        | float64 | 14 日相对强弱指数：通过收盘价涨跌幅度计算，取值范围 0-100 | 超买超卖判断，选股中需处于 30-50 区间（中性偏强，非超跌） |
| `rsi14_3d_min` | float64 | 当日、前 1 日、前 2 日`rsi14`的最小值         | 确认回调阶段是否超跌，选股需满足≥30（避免过度下跌）      |

## 六、启动信号指标（判断回调后是否启动）



| 字段名称          | 数据类型 | 计算逻辑                                   | 选股作用                |
| ------------- | ---- | -------------------------------------- | ------------------- |
| `price_up_3d` | bool | 当日收盘价 > 前 1 日收盘价 且 前 1 日收盘价 > 前 2 日收盘价 | 价格逐步抬升信号，确认短期上涨趋势启动 |

## 七、选股策略与字段对应关系总结



| 选股核心环节 | 涉及字段                                          | 核心阈值要求（参考）                           |
| ------ | --------------------------------------------- | ------------------------------------ |
| 前期上涨铺垫 | `high_30d`、`pullback_ratio`、`pullback_days`   | 30 日涨幅≥20%，回调幅度 10%-20%，回调天数 10-20 天 |
| 量能支撑   | `volume_ratio_5d`、`obv`                       | 上涨放量≥1.2，回调缩量≤0.8，OBV 留存率≥80%        |
| 支撑位企稳  | `ma20`、`bollinger_lower`、`rsi14_3d_min`       | 站稳 MA20，触及布林带下轨，RSI≥30               |
| 启动信号确认 | `price_up_3d`、`macd_golden_cross`、`macd_hist` | 3 日价格抬升，MACD 金叉，MACD 柱状图≥0           |

## 八、数据质量说明



1. **缺失值处理**：所有指标字段缺失值已填充为 0（关键指标如`high_30d`、`close`缺失的行已剔除）。

2. **异常值处理**：计算过程中分母为 0 的情况已替换为 0.0001，避免无穷大 / 无穷小值。

3. **无未来函数**：所有指标均基于当日及历史数据计算，无任何未来信息泄露，可安全用于回测与实盘。

> （注：文档部分内容可能由 AI 生成）